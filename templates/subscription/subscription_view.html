<form action="{% url 'subs:create_subscription_session' subscription.id %}" method="POST">
                    {% csrf_token %}
                    <button type="submit">Purchase</button>
                </form>
<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe("{{ STRIPE_PUBLISHABLE_KEY }}");

    document.getElementById('subscription-form').addEventListener('submit', function(event) {
        event.preventDefault();

        const planId = document.getElementById('plan-id').value;

        fetch("{% url 'subs:create_subscription_session' plan_id=0 %}".replace('0', planId), {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}",
            },
            body: JSON.stringify({})
        })
        .then(response => response.json())
        .then(data => {
            if (data.id) {
                stripe.redirectToCheckout({ sessionId: data.id })
                .then(function (result) {
                    if (result.error) {
                        console.error(result.error.message);
                    }
                });
            } else {
                console.error("Session creation failed:", data);
            }
        })
        .catch(error => console.error("Error:", error));
    });
</script>
